(function(e){e.PhotoMosaic||(e.PhotoMosaic={})})(window);
(function(e){var h=function(){};h.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(c,a,b,d){d||(this.context=a,this.buffer=[]);if(this.includes("",c)){c=this.render_pragmas(c);c=this.render_section(c,a,b);if(d)return this.render_tags(c,a,b,d);this.render_tags(c,a,b,d)}else{if(d)return c;this.send(c)}},send:function(c){""!=c&&this.buffer.push(c)},render_pragmas:function(c){if(!this.includes("%",c))return c;var a=this;return c.replace(RegExp(this.otag+
"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(b,d,c){if(!a.pragmas_implemented[d])throw{message:"This implementation of mustache doesn't understand the '"+d+"' pragma"};a.pragmas[d]={};c&&(b=c.split("="),a.pragmas[d][b[0]]=b[1]);return""})},render_partial:function(c,a,b){c=this.trim(c);if(!b||void 0===b[c])throw{message:"unknown_partial '"+c+"'"};return"object"!=typeof a[c]?this.render(b[c],a,b,!0):this.render(b[c],a[c],b,!0)},render_section:function(c,a,b){if(!this.includes("#",c)&&!this.includes("^",
c))return c;var d=this;return c.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(c,e,h,f){c=d.find(h,a);if("^"==e)return!c||d.is_array(c)&&0===c.length?d.render(f,a,b,!0):"";if("#"==e)return d.is_array(c)?d.map(c,function(a){return d.render(f,d.create_context(a),b,!0)}).join(""):d.is_object(c)?d.render(f,d.create_context(c),b,!0):"function"===typeof c?c.call(a,f,function(c){return d.render(c,a,b,!0)}):c?d.render(f,
a,b,!0):""})},render_tags:function(c,a,b,d){var g=this,e=function(){return RegExp(g.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+g.ctag+"+","g")},h=e(),f=function(d,c,f){switch(c){case "!":return"";case "=":return g.set_delimiters(f),h=e(),"";case ">":return g.render_partial(f,a,b);case "{":return g.find(f,a);default:return g.escape(g.find(f,a))}};c=c.split("\n");for(var k=0;k<c.length;k++)c[k]=c[k].replace(h,f,this),d||this.send(c[k]);if(d)return c.join("\n")},set_delimiters:function(c){c=c.split(" ");
this.otag=this.escape_regex(c[0]);this.ctag=this.escape_regex(c[1])},escape_regex:function(c){arguments.callee.sRE||(arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g"));return c.replace(arguments.callee.sRE,"\\$1")},find:function(c,a){c=this.trim(c);var b;!1===a[c]||0===a[c]||a[c]?b=a[c]:(!1===this.context[c]||0===this.context[c]||this.context[c])&&(b=this.context[c]);return"function"===typeof b?b.apply(a):void 0!==b?b:""},includes:function(c,a){return-1!=a.indexOf(this.otag+
c)},escape:function(c){c=String(null===c?"":c);return c.replace(/&(?!\w+;)|["'<>\\]/g,function(a){switch(a){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return a}})},create_context:function(c){if(this.is_object(c))return c;var a=".";this.pragmas["IMPLICIT-ITERATOR"]&&(a=this.pragmas["IMPLICIT-ITERATOR"].iterator);var b={};b[a]=c;return b},is_object:function(c){return c&&"object"==typeof c},is_array:function(c){return"[object Array]"===
Object.prototype.toString.call(c)},trim:function(c){return c.replace(/^\s*|\s*$/g,"")},map:function(c,a){if("function"==typeof c.map)return c.map(a);for(var b=[],d=c.length,g=0;g<d;g++)b.push(a(c[g]));return b}};e.PhotoMosaic||(e.PhotoMosaic={});e.PhotoMosaic.Mustache={name:"mustache.js",version:"0.3.1-dev",to_html:function(c,a,b,d){var g=new h;d&&(g.send=d);g.render(c,a,b);if(!d)return g.buffer.join("\n")}}})(window);
(function(e){e.PhotoMosaic||(e.PhotoMosaic={});e=e.PhotoMosaic;var h,c=this.document,a=function(a,b){for(var d in a){var c=a[d];if(!~(""+c).indexOf("-")&&void 0!==j[c])return"pfx"==b?c:!0}return!1},b=function(b,d,c){var g=b.charAt(0).toUpperCase()+b.slice(1),e=(b+" "+l.join(g+" ")+g).split(" ");if("string"===typeof d||"undefined"===typeof d)d=a(e,d);else{e=(b+" "+f.join(g+" ")+g).split(" ");a:{b=e;for(var h in b)if(g=d[b[h]],void 0!==g){d=!1===c?b[h]:"function"===typeof g?g.bind(c||d):g;break a}d=
!1}}return d},d={},g=c.documentElement,c=c.createElement("modernizr"),j=c.style,l=["Webkit","Moz","O","ms"],f=["webkit","moz","o","ms"],c={},k=[],n=k.slice,m={}.hasOwnProperty,p;"undefined"!==typeof m&&"undefined"!==typeof m.call?p=function(a,b){return m.call(a,b)}:p=function(a,b){return b in a&&"undefined"===typeof a.constructor.prototype[b]};Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var d=n.call(arguments,1),c=function(){if(this instanceof
c){var g=function(){};g.prototype=b.prototype;var g=new g,f=b.apply(g,d.concat(n.call(arguments)));return Object(f)===f?f:g}return b.apply(a,d.concat(n.call(arguments)))};return c});c.csstransforms=function(){return!!b("transform")};c.csstransitions=function(){return b("transition")};for(var q in c)p(c,q)&&(h=q.toLowerCase(),d[h]=c[q](),k.push((d[h]?"":"no-")+h));d.addTest=function(a,b){if("object"==typeof a)for(var c in a)p(a,c)&&d.addTest(c,a[c]);else{a=a.toLowerCase();if(void 0!==d[a])return d;
b="function"==typeof b?b():b;g.className+=" PM_"+(b?"":"no-")+a;d[a]=b}return d};j.cssText="";h=(c=null,d._version="2.6.2",d._domPrefixes=f,d._cssomPrefixes=l,d.testProp=function(b){return a([b])},d.testAllProps=b,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(" PM_js PM_"+k.join(" PM_")),d);e.Modernizr=h})(window);
(function(e,h){var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(a){function b(){var b=e(n),d=e(m);j&&(m.length?j.reject(f,b,d):j.resolve(f));e.isFunction(a)&&a.call(g,f,b,d)}function d(a,d){a.src===c||-1!==e.inArray(a,k)||(k.push(a),d?m.push(a):n.push(a),e.data(a,"imagesLoaded",{isBroken:d,src:a.src}),l&&j.notifyWith(e(a),[d,f,e(n),e(m)]),f.length===k.length&&(setTimeout(b),f.unbind(".imagesLoaded")))}var g=this,j=e.isFunction(e.Deferred)?e.Deferred():
0,l=e.isFunction(j.notify),f=g.find("img").add(g.filter("img")),k=[],n=[],m=[];e.isPlainObject(a)&&e.each(a,function(b,d){if("callback"===b)a=d;else if(j)j[b](d)});f.length?f.bind("load.imagesLoaded error.imagesLoaded",function(a){d(a.target,"error"===a.type)}).each(function(a,b){var g=b.src,f=e.data(b,"imagesLoaded");if(f&&f.src===g)d(b,f.isBroken);else if(b.complete&&b.naturalWidth!==h)d(b,0===b.naturalWidth||0===b.naturalHeight);else if(b.readyState||b.complete)b.src=c,b.src=g}):b();return j?j.promise(g):
g}})(jQuery);
(function(e){var h={list:[],log:function(a){this.list.push(a);"undefined"!=console&&console.log(a)},print:function(a){var b=[];0<this.list.length&&(b=this.list,a.prepend(e(this.templateWrapper).html(PhotoMosaic.Mustache.to_html(this.template,{messages:b}))),this.list=[])},templateWrapper:'<div class="photomosaic-errors"></div>',template:"{{#messages}}<p>{{.}}</p>{{/messages}}"};window.PhotoMosaic&&(window.PhotoMosaic.$=e,window.PhotoMosaic.mosaics=[]);var c=function(){};e.extend(c.prototype,{defaults:{input:"json",
gallery:"PMalbum",padding:2,columns:3,width:"auto",height:"auto",links:!0,external_links:!1,random:!1,force_order:!1,auto_columns:!1,center:!0,show_loading:!1,loading_transition:"fade",modal_name:null,modal_group:!0,modal_ready_callback:null,log_gallery_data:!1,debug:!0},init:function(a,b){var d=this;this.opts=e.extend({},this.defaults,b);this.obj=e(a);this.id=Date.parse(new Date)+Math.round(1E4*Math.random());this.preload="PM_preloadify"+this.id;this.images=[];this.columns=[];"auto"===this.opts.width&&
(this.opts.width=this.obj.width());this.template=' <div id="photoMosaic_'+this.id+'" class="photoMosaic loading {{transition}}" style="width:{{width}}px; {{#center}}margin-left:auto; margin-right:auto;{{/center}}">{{#columns}}<ol style="float:left; margin:0 {{^last}}{{padding}}px 0 0{{/last}} !important;">{{#images}}<li class="loading" style="width:{{#width}}{{constraint}}{{/width}}px; height:{{#height}}{{constraint}}{{/height}}px; margin:0 {{^last}}0 {{padding}}px 0{{/last}} !important;">{{#link}}<a href="{{path}}" {{#external}}target="_blank"{{/external}} {{#modal}}rel="{{modal}}"{{/modal}} {{#caption}}title="{{caption}}"{{/caption}}>{{/link}}{{^link}}<span>{{/link}}<img src="{{src}}" style="width:{{#width}}{{adjusted}}{{/width}}px; height:{{#height}}{{adjusted}}{{/height}}px; {{#adjustment}}{{type}}:-{{value}}px;{{/adjustment}}" title="{{caption}}"/>{{#link}}</a>{{/link}}{{^link}}</span>{{/link}}</li>{{/images}}</ol>{{/columns}}</div>';
this.loading_template=' <div id="photoMosaic_'+this.id+'" class="photoMosaic"><div class="photoMosaicLoading">loading gallery...</div></div>';if("xml"===this.opts.input&&""===this.opts.gallery)h.log("PhotoMosaic: ERROR: No XML file path specified.");else if("xml"===this.opts.input&&"PMalbum"===this.opts.gallery)h.log("PhotoMosaic: ERROR: No XML file path specified.");else if("json"===this.opts.input&&""===this.opts.gallery)h.log("PhotoMosaic: ERROR: No JSON object defined.");else if("json"===this.opts.input&&
0===this.opts.gallery.length)h.log("PhotoMosaic: ERROR: Specified gallery data is empty.");else{if("json"===this.opts.input&&"PMalbum"===this.opts.gallery)if("undefined"!==PMalbum)this.opts.gallery=PMalbum;else{h.log('PhotoMosaic: ERROR: The JSON object "PMalbum" can not be found.');return}this.opts.gallery.length-1<this.current_album?h.log('PhotoMosaic: ERROR: "start_album" uses a 0-index (0 = the first album).No album was found at the specified index ('+this.current_album+")"):(this.opts.show_loading&&
this.obj.html(PhotoMosaic.Mustache.to_html(this.loading_template,{})),this.opts.gallery=this.getGalleryData(),this.opts.columns=this.autoCols(),this.col_mod=(this.opts.width-this.opts.padding*(this.opts.columns-1))%this.opts.columns,this.col_width=(this.opts.width-this.col_mod-this.opts.padding*(this.opts.columns-1))/this.opts.columns-2,this.hasDims()?(this.opts.gallery=this.prepData(this.opts.gallery),this.render()):e.when(this.preloadify()).then(function(){d.opts.gallery=d.addPreloadData(d.opts.gallery);
d.render()}))}},render:function(){var a=this;this.obj.html(this.makeMosaic());this.obj.imagesLoaded({progress:function(a,d,c){setTimeout(function(){e(c[c.length-1]).parents("li").removeClass("loading")},0)},always:function(){setTimeout(function(){a.obj.children(".photoMosaic").removeClass("loading")},1E3)}});this.modalCallback();this.opts.log_gallery_data&&this.logGalleryData();this.opts.debug&&h.print(this.obj)},makeMosaic:function(){var a=this;e.each(this.opts.gallery,function(){var b=e.extend(!0,
{},this),d=b.thumb&&""!==b.thumb?b.thumb:b.src;b.full=b.src;b.src=d;b.padding=a.opts.padding;b.width.adjusted=a.col_width;b.height.adjusted=Math.floor(b.height.original*b.width.adjusted/b.width.original);a.opts.modal_name&&(d=a.opts.modal_group?a.opts.modal_name+"["+a.id+"]":a.opts.modal_name,b.modal=d);a.opts.links&&b.url?(b.link=!0,b.path=b.url,b.external=a.opts.external_links,delete b.modal):a.opts.links?(b.link=!0,b.path=b.full,b.external=a.opts.external_links):b.link=!1;a.images.push(b)});this.images=
this.errorCheck(this.images);this.opts.force_order||(this.images.sort(function(b,d){return a.opts.random?0.5-Math.random():b.height.original-d.height.original}),this.images.reverse());var b=[],d=!0;if(!this.opts.force_order){for(;0<this.images.length;)d?b.push(this.images.shift()):b.push(this.images.pop()),d=!d;this.images=b}for(d=b=0;d<this.images.length;d++)b===this.opts.columns&&(b=0),this.columns[b]||(this.columns[b]=[]),this.columns[b].push(this.images[d]),b++;if(this.opts.force_order){b=[];
for(d=0;d<this.columns.length;d++)for(var c=0;c<this.columns[d].length;c++)b[d]||(b[d]=[]),b[d].push(this.images[0]),this.images.shift();this.columns=b}for(var b={transition:this.getTransition(),width:this.opts.width,center:this.opts.center,columns:[]},j=[],d=0;d<this.columns.length;d++){for(var l=0,c=0;c<this.columns[d].length;c++)l+=this.columns[d][c].height.adjusted;l+=(this.columns[d].length-1)*this.opts.padding;j.push(l);b.columns[d]={};b.columns[d].images=this.columns[d];b.columns[d].height=
l;b.columns[d].padding=this.opts.padding}d=this.getSmallest(j);c=this.getBiggest(j);d=Math.floor((d+c)/2);b="auto"===this.opts.height?this.adjustHeights(b,d):this.adjustHeights(b,this.opts.height);return this.layoutHasErrors(b)?(h.log("PhotoMosaic: ERROR: Your gallery's height is too small for your current settings and won't render correctly."),PhotoMosaic.Mustache.to_html("",{})):PhotoMosaic.Mustache.to_html(this.template,b)},adjustHeights:function(a,b){a=this.markLastColumn(a);for(i=0;i<a.columns.length;i++)a=
this.markLastImageInColumn(a,i),a.columns[i]=a.columns[i].height>b?this.scaleColumnDown(a.columns[i],b):this.scaleColumnUp(a.columns[i],b);return a},autoCols:function(){var a=this.opts.gallery.length,b=0,d=0;if(this.opts.auto_columns){if(a<this.opts.columns)b=a;else for(;0===b;)a<=(d+4)*(d+3)?b=d+4:++d;return b}return this.opts.columns},scaleColumnDown:function(a,b){for(var d=a.images.length,c=a.height-b,e=Math.floor(c/d),c=e+c%d,h=this.findLargestImage(a.images),f=0;f<d;f++)a.images[f].height.constraint=
f===h.index?a.images[f].height.adjusted-c:a.images[f].height.adjusted-e,a.images[f].width.constraint=a.images[f].width.adjusted,a.images[f].adjustment={type:"top",value:Math.floor((a.images[f].height.adjusted-a.images[f].height.constraint)/2)};return a},scaleColumnUp:function(a,b){for(var d=a.images.length,c=b-a.height,e=Math.floor(c/d),c=e+c%d,h=this.findSmallestImage(a.images),f=0;f<d;f++)a.images[f].height.constraint=f===h.index?a.images[f].height.adjusted+c:a.images[f].height.adjusted+e,a.images[f].width.constraint=
a.images[f].width.adjusted,a.images[f].width.adjusted=Math.floor(a.images[f].width.adjusted*a.images[f].height.constraint/a.images[f].height.adjusted),a.images[f].height.adjusted=a.images[f].height.constraint,a.images[f].adjustment={type:"left",value:Math.floor((a.images[f].width.adjusted-a.images[f].width.constraint)/2)};return a},getSmallest:function(a){for(var b=0,d=0;d<a.length;d++)0===b?b=a[d]:a[d]<b&&(b=a[d]);return b},getBiggest:function(a){for(var b=0,d=0;d<a.length;d++)a[d]>b&&(b=a[d]);return b},
findSmallestImage:function(a){for(var b=0,d=0,c=0;c<a.length;c++)0===b?b=a[c].height.adjusted:a[c].height.adjusted<b&&(b=a[c].height.adjusted,d=c);return{height:b,index:d}},findLargestImage:function(a){for(var b=0,d=0,c=0;c<a.length;c++)a[c].height.adjusted>b&&(b=a[c].height.adjusted,d=c);return{height:b,index:d}},markLastColumn:function(a){a.columns[a.columns.length-1].last=!0;return a},markLastImageInColumn:function(a,b){a.columns[b].images[a.columns[b].images.length-1].last=!0;return a},errorCheck:function(a){var b=
[];e.each(a,function(a){isNaN(this.height.adjusted)&&b.push(a)});for(var d=b.length-1;0<=d;d--){h.log("PhotoMosaic: ERROR: The following image failed to load and was skipped.\n"+a[b[d]].src);var c=a.slice(b[d]+1);a.length=b[d];a.push.apply(a,c)}return a},layoutHasErrors:function(a){for(var b=!1,d=0;d<a.columns.length;d++)for(var c=0;c<a.columns[d].images.length;c++)0>=a.columns[d].images[c].height.constraint&&(b=!0);return b},preloadify:function(){var a=e("<div>").attr({id:this.preload,"class":"PM_preloadify"});
e.each(this.opts.gallery,function(){var b=this.thumb&&""!==this.thumb?this.thumb:this.src,b=e("<img>").attr({src:b});a.append(b)});e("body").append(a);return a.imagesLoaded()},addPreloadData:function(a){var b=e("#"+this.preload);e.each(a,function(){var a=b.find('img[src="'+(this.thumb&&""!==this.thumb?this.thumb:this.src)+'"]');this.width={original:a.width()};this.height={original:a.height()}});return a},prepData:function(a){var b=0,d=0;e.each(a,function(){b=parseInt(this.width);d=parseInt(this.height);
this.width={original:b};this.height={original:d}});return a},getGalleryData:function(){var a=this,b;"html"===this.opts.input?b=this.constructGalleryFromHTML():"xml"===this.opts.input?e.get(this.opts.gallery,function(d){0<e(d).find("photos").length?(b=e(d).find("photos"),b=a.constructGalleryFromXML(b)):h.log("PhotoMosaic: ERROR: The XML either couldn't be found or was malformed.")}):"json"===this.opts.input&&(b=this.opts.gallery);return b},constructGalleryFromHTML:function(){for(var a=[],b=this.obj.find("img"),
d=0;d<b.length;d++){var c={};c.src=0<b.eq(d).parent("a").length&&this.opts.links?b.eq(d).parent("a").attr("href"):b.eq(d).attr("src");c.caption=b.eq(d).attr("title");a.push(c)}return a},constructGalleryFromXML:function(a){var b=[];a.find("photo").each(function(){var a={},c=e(this);a.caption=c.children("title").text();a.src=c.children("src").text();a.thumb=c.children("thumb").text();a.url=c.children("url").text();a.width=c.children("width").text();a.height=c.children("height").text();b.push(a)});return b},
hasDims:function(){var a=!1,b=!0;if(void 0!==this.hasSpecifiedDims)return this.hasSpecifiedDims;for(var c=0;c<this.opts.gallery.length;c++)this.opts.gallery[c].hasOwnProperty("width")&&this.opts.gallery[c].hasOwnProperty("height")?isNaN(parseInt(this.opts.gallery[c].width))||isNaN(parseInt(this.opts.gallery[c].height))?b=!1:a=!0:b=!1;a&&!b&&h.log("PhotoMosaic: ERROR: Width / Height data not present for all images.");return this.hasSpecifiedDims=b},getTransition:function(){var a="none";PhotoMosaic.Modernizr.csstransitions&&
PhotoMosaic.Modernizr.csstransforms&&(a=this.opts.loading_transition);return"transition-"+a},modalCallback:function(){var a=this.obj.children().get(0);e.isFunction(this.opts.modal_ready_callback)&&this.opts.modal_ready_callback.apply(this,[a])},logGalleryData:function(){for(var a=[],b=0;b<this.opts.gallery.length;b++)a.push({src:this.opts.gallery[b].src,thumb:this.opts.gallery[b].thumb,caption:this.opts.gallery[b].caption,width:this.opts.gallery[b].width.original,height:this.opts.gallery[b].height.original});
h.log("PhotoMosaic: Generate Gallery Data...");h.log(JSON.stringify(a))}});e.fn.photoMosaic=function(a){this.each(function(b){this.photoMosaic||(this.photoMosaic=new c,this.photoMosaic.init(this,a,b),window.PhotoMosaic.mosaics.push({el:this,opts:a}))});return this}})(jQuery);
